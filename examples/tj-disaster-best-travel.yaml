#
# Define name of the simulation. Used in file system naming.
#
name: tj-disaster-best-travel
case_quantity: 50

#
# Define how the source data is used:
#
demands:
  class: ems.datasets.demand.DemandSet
  filename: "examples/simple/demand_points.csv"

all_bases:
  class: ems.datasets.base.BaseSet
  filename: "examples/simple//bases.csv"

tt:
  class: ems.datasets.times.TravelTimes
  filename: "examples/simple/times.csv"
  origins: $all_bases
  destinations: $demands

simulation_bases:
  class: ems.datasets.base.BaseSet
  filename: "examples/simple/bases_subset.csv"

#
# Define the zones for multi-polygon case generation 
#
# tj-zones: 
#   class: ems.generators.location.multiple_polygon.MultiPolygonLocationGenerator
#   longitudes_file: "../longitudes.yaml"
#   latitudes_file: "../latitudes.yaml"

tj-zones: # A location generator object
  class: ems.generators.location.CircleLocationGenerator
  center_latitude: 32.880796
  center_longitude: -117.237047
  radius_km: 1.8


#
# Define how EMS agents are selected
#
ambulances:
  class: ems.datasets.ambulance.BaseSelectedAmbulanceSet
  count: 12

  base_selector:
    class: ems.algorithms.base.RoundRobinBaseSelector
    base_set: $simulation_bases

hospitals:
  class: ems.datasets.hospital.HospitalSet
  latitudes: [32.52506901611384, 32.5027, 32.5180]
  longitudes: [-117.0097589492798, -117.00371, -117.0078]

event_gen:
  class: ems.generators.event.EventGenerator

  # Travel times between events estimated using travel times matrix
  travel_duration_generator:
    class: ems.generators.duration.TravelTimeDurationGenerator
    travel_times: $tt
    epsilon: 0.001

  # Duration at incident drawn from uniform distribution between 5 and 10 minutes
  incident_duration_generator:
    class: ems.generators.duration.RandomDurationGenerator
    lower_bound: 5
    upper_bound: 10

  # Duration at hospital drawn from uniform distribution between 5 and 10 minutes
  hospital_duration_generator:
    class: ems.generators.duration.RandomDurationGenerator
    lower_bound: 5
    upper_bound: 10

  hospital_selector: # Fastest hospital chosen
    class: ems.algorithms.hospital.FastestHospitalSelector
    hospital_set: $hospitals
    travel_times: $tt

#
# Define each scenario
# Below is night, morning, afternoon, evening. Weekday and then weekend.
 # [0.010833333333333334,
  # 0.02275,
  # 0.026972222222222224,
  # 0.024138888888888887,

  # 0.017055555555555553,
  # 0.02511111111111111,
  # 0.027944444444444445,
  # 0.029361111111111112]
#
night:
  class: ems.datasets.case.RandomCaseSet
  time: 2019-03-22T00:00:00Z

  case_time_generator: # Cases arise based on a Poisson distribution
    class: ems.generators.duration.PoissonDurationGenerator
    lmda: 0.010833333333333334

  # case_location_generator: # Cases generated uniformly in a polygon in Tijuana
  #   class: ems.generators.location.polygon.PolygonLocationGenerator
  #   vertices_latitude: [32.533696, 32.53, 32.469300, 32.45, 32.530337]
  #   vertices_longitude: [-117.123506, -116.876454, -116.82, -116.967181, -117.123475]

  case_location_generator: $tj-zones
  event_generator: $event_gen

morning:
  class: ems.datasets.case.RandomCaseSet
  time: 2019-03-22T00:00:00Z

  case_time_generator: # Cases arise based on a Poisson distribution
    class: ems.generators.duration.PoissonDurationGenerator
    lmda: 0.02275

  # case_location_generator: # Cases generated uniformly in a polygon in Tijuana
  #   class: ems.generators.location.polygon.PolygonLocationGenerator
  #   vertices_latitude: [32.533696, 32.53, 32.469300, 32.45, 32.530337]
  #   vertices_longitude: [-117.123506, -116.876454, -116.82, -116.967181, -117.123475]

  case_location_generator: $tj-zones
  event_generator: $event_gen

afternoon:
  class: ems.datasets.case.RandomCaseSet
  time: 2019-03-22T00:00:00Z

  case_time_generator: # Cases arise based on a Poisson distribution
    class: ems.generators.duration.PoissonDurationGenerator
    lmda: 0.026972222222222224

  # case_location_generator: # Cases generated uniformly in a polygon in Tijuana
  #   class: ems.generators.location.polygon.PolygonLocationGenerator
  #   vertices_latitude: [32.533696, 32.53, 32.469300, 32.45, 32.530337]
  #   vertices_longitude: [-117.123506, -116.876454, -116.82, -116.967181, -117.123475]
  case_location_generator: $tj-zones
  event_generator: $event_gen

evening:
  class: ems.datasets.case.RandomCaseSet
  time: 2019-03-22T00:00:00Z

  case_time_generator: # Cases arise based on a Poisson distribution
    class: ems.generators.duration.PoissonDurationGenerator
    lmda: 0.024138888888888887

  # case_location_generator: # Cases generated uniformly in a polygon in Tijuana
  #   class: ems.generators.location.polygon.PolygonLocationGenerator
  #   vertices_latitude: [32.533696, 32.53, 32.469300, 32.45, 32.530337]
  #   vertices_longitude: [-117.123506, -116.876454, -116.82, -116.967181, -117.123475]

  case_location_generator: $tj-zones
  event_generator: $event_gen

disaster:
  class: ems.datasets.case.RandomCaseSet
  time: 2019-03-22T00:00:00Z

  case_time_generator: # Cases arise based on a Poisson distribution
    class: ems.generators.duration.PoissonDurationGenerator
    lmda: 0.99

  # case_location_generator: # Cases generated uniformly in a polygon in Tijuana
  #   class: ems.generators.location.polygon.PolygonLocationGenerator
  #   vertices_latitude: [32.533696, 32.53, 32.469300, 32.45, 32.530337]
  #   vertices_longitude: [-117.123506, -116.876454, -116.82, -116.967181, -117.123475]

  case_location_generator: $tj-zones
  event_generator: $event_gen

#
# Define the hierarchy for each scenario
#
cases:
  class: ems.datasets.scenario.ScenarioCaseSet
  time: 2019-03-22T00:00:00Z
  quantity: $case_quantity

  scenarios:
    - class: ems.scenarios.scenario.Scenario
      label: night
      priority: 2
      case_set: $night

      triggers:
        - class: ems.triggers.trigger.TimeTrigger
          start_time: 2019-03-22T00:00:00.0Z
          duration: 6 # in hours
          interval: 24 # in hours


    - class: ems.scenarios.scenario.Scenario
      label: morning
      priority: 2
      case_set: $morning

      triggers:
        - class: ems.triggers.trigger.TimeTrigger
          start_time: 2019-03-22T06:00:00.0Z
          duration: 6 # in hours
          interval: 24 # in hours


    - class: ems.scenarios.scenario.Scenario
      label: afternoon
      priority: 2
      case_set: $afternoon

      triggers:
        - class: ems.triggers.trigger.TimeTrigger
          start_time: 2019-03-22T12:00:00.0Z
          duration: 6 # in hours
          interval: 24 # in hours


    - class: ems.scenarios.scenario.Scenario
      label: evening
      priority: 2
      case_set: $evening

      triggers:
        - class: ems.triggers.trigger.TimeTrigger
          start_time: 2019-03-22T18:00:00.0Z
          duration: 6 # in hours
          interval: 24 # in hours


    - class: ems.scenarios.scenario.Scenario
      label: disaster
      priority: 1
      case_set: $disaster

      triggers:
        - class: ems.triggers.trigger.TimeTrigger
          start_time: 2019-03-22T14:30:00.0Z
          duration: 0.3 # in hours
          interval: 24 # Repeat the disaster so that we can flesh out the data with many cases.

#
# Multizone: 100 zones of varying sizes, each with 0.01 probability. 
#



#
# Simulator configurations: How data is accumulated and how the simulator is run.
#
metric_aggregator:
  class: ems.analysis.metric.MetricAggregator

  metrics:
    - class: ems.analysis.coverage.PercentDoubleCoverage
      r1: 600
      demands: $demands
      travel_times: $tt
    - class: ems.analysis.metric.TotalDelay
    - class: ems.analysis.metric.CountPending

simulator:
  class: ems.simulators.simulator.EventDispatcherSimulator
  debug: False
  ambulances: $ambulances
  cases: $cases

  ambulance_selector:
    class: ems.algorithms.ambulance.BestTravelTime
    travel_times: $tt

  metric_aggregator: $metric_aggregator
